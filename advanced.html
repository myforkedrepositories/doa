<!DOCTYPE html>
<html>
<head>
	<title>Diamond open access</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
	<h2>Diamond open access journals</h2>
	<p>Search <a href="https://en.wikipedia.org/wiki/Diamond_open_access">Diamond open access</a> journals for 
    <a href="https://github.com/restrepo/diamond/blob/main/static/data/level_1_concepts.csv">OpenAlex concepts:</a> </p>
<p>
	  Add the OpenAlex concept identification at the end of the URL, e.g <code>?concept=C36289849</code>:  Obtain them from the 
	  <a href="https://docs.google.com/spreadsheets/d/1LBFHjPt4rj_9r0t0TTAlT68NwOtNH8Z21lBMsJDMoZg/edit#gid=1473310811">official spreadsheet here<a>
	  or edit the URL at the end: from the <a href="https://api.openalex.org/concepts?filter=display_name.search:concept_here">OpenAlex API</a>
	  (or <a href="https://api.openalex.org/concepts?filter=level:0">by level</a>)
	</p>
  
	<h3>Results</h3>
	<p>Only first 25 journals are shown</p>
	<hr>
	<!-- "debug" look for `document.querySelector("#debug").innerText` in the script -->
	<div id="debug"></div>
	<script>
		// **** BEGIN: Get the URL parameter: `concept` ****
		// https://www.sitepoint.com/get-url-parameters-with-javascript/
		const queryString = window.location.search;
		console.log(queryString);
		// ?product=shirt&color=blue&newuser&size=m
		const urlParams = new URLSearchParams(queryString);
		const concept = urlParams.get('concept');

		console.log("concept: " + concept);
		if (!concept) {
			console.log("Not concept");
			throw 'bye';
		}			
		// C109214941 or ... for example
		// **** END: Get the URL parameter: `concept`   ****

                //*** CODE IS THE SAME FROM HERE: Copy and Paste from index.html    
		function insertCell(ctext) {
			const cell = document.createElement("td");
			const celltext = document.createTextNode(ctext);
			cell.appendChild(celltext)
			return cell;
		};
		
		const tbl = document.createElement("table");
  		const tblHead = document.createElement("thead");		
  		const tblBody = document.createElement("tbody");		
		//row
		const row1 = document.createElement("tr");
      		row1.appendChild( insertCell("Journal") );
      		row1.appendChild( insertCell("Publisher") );
		row1.appendChild( insertCell("Country") );
		row1.appendChild( insertCell("Articles") );
		row1.appendChild( insertCell("Citations") );
		row1.appendChild( insertCell("h-index") );
    		tblHead.appendChild(row1);
		//end row
		tbl.appendChild(tblHead);

		// Use an API-REST call to get the `data` for the url parameter `concept` 
		const apirest = "https://api.openalex.org/sources?filter=concepts.id:" + concept + ",apc_usd:0";
		console.log(apirest);
		//window.addEventListener("DOMContentLoaded", () => {
  		// console.log('DOM fully loaded and parsed');
  		//output.textContent = "Loading....";
		fetch(apirest)
		.then(response => response.json())
		.then((data) => {
		      // we call that data here
		      console.log(data); // check the data on the console
		      //output.innerHTML = ""; // Initial content is empty
		      data.results.forEach((el) => {
		        // loop through the json data using forEach method
		        // console.log(el);
		        jsonList(el); // calling jsonList function
		      });
		    });

		// Create a function to display the json data dynamically on the webpage
		function jsonList(item) {
		       //document.querySelector("#debug").innerHTML = `${document.querySelector("#debug").innerHTML}  <tr><th>${item.display_name}</th> <th>${item.host_organization_name}</th> <th>${item.country_code}</th> <th>${item.works_count}</th> <th>${item.cited_by_count}</th>  <th>${item.summary_stats.h_index}</th></tr>`; 	
			//row
			const row2 = document.createElement("tr");
			
	      		row2.appendChild( insertCell(`${item.display_name}`) );
	      		row2.appendChild( insertCell(`${item.host_organization_name}`) );
			row2.appendChild( insertCell( regionNames.of( `${item.country_code}`) ) );
			row2.appendChild( insertCell(`${item.works_count}`) );
			row2.appendChild( insertCell(`${item.cited_by_count}`) );
			row2.appendChild( insertCell(`${item.summary_stats.h_index}`) );
			tblBody.appendChild(row2);
			//end row
			
		};
		
                // put the <tbody> in the <table>
  		tbl.appendChild(tblBody);
  		// appends <table> into <body>
		//https://stackoverflow.com/a/7018615/2268280
  		document.querySelector("#debug").appendChild(tbl);
  		// sets the border attribute of tbl to '2'
  		tbl.setAttribute("border", "1");
		//tbl.setAttribute("style", "width:100%");
	</script>
	<hr>
	<h3><a href="https://restrepo.github.io/diamondoa">Search with level-one OpenAlex concepts</a></h3>
	
	<p>Code: <a href="https://github.com/restrepo/diamondoa"><i style="font-size:24px" class="fa">&#xf09b;</i></a></p> 
</body>
</html>
