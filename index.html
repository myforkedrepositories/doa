<!DOCTYPE html>
<html>
<head>
	<title>Diamond open access</title>
</head>
<body>
	<h1>Diamond Open Alex Journal search</h1>
	<p>for <a href="https://github.com/restrepo/diamond/blob/main/static/data/level_1_concepts.csv">level-one OpenAlex concepts</a> </p>
	<form action="">
	  <p><label for="concept">Select a level-one OpenAlex concept:</label></p>
	  <select name="concept" id="concept">
	    <option value="C109214941">Particle physics</option>		  
	  </select>
	  <br><br>
	  <input type="submit" value="Submit">
	</form>
	
	<!-- "debug" look for `document.querySelector("#debug").innerText` in the script -->
	<div id="debug"></div>
	<script>
		// **** BEGIN: Get the URL parameter: `concept` ****
		// https://www.sitepoint.com/get-url-parameters-with-javascript/
		const queryString = window.location.search;
		console.log(queryString);
		// ?product=shirt&color=blue&newuser&size=m
		const urlParams = new URLSearchParams(queryString);
		const concept = urlParams.get('concept');
		console.log(concept);
		if (!concept) {
			console.log("Not concept");
			throw 'bye';
		}
		// C109214941 or ... for example
		// **** END: Get the URL parameter: `concept`   ****
		// Use an API-REST call to get the `data` for the url parameter `concept`
		const apirest = "https://api.openalex.org/sources?filter=concepts.id:" + concept + ",apc_usd:0";
		console.log(apirest);
		//window.addEventListener("DOMContentLoaded", () => {
  		// console.log('DOM fully loaded and parsed');
  		//output.textContent = "Loading....";
		fetch(apirest)
		.then(response => response.json())
		.then((data) => {
		      // we call that data here
		      console.log(data); // check the data on the console
		      //output.innerHTML = ""; // Initial content is empty
		      data.forEach((el) => {
		        // loop through the json data using forEach method
		        // console.log(el);
		        jsonList(el); // calling jsonList function
		      });
		    });
		//});
		//.then(data => {
		//	console.log(data.results[0]) <!-- This is to debug -->
		//	// "works_count": 64913, "cited_by_count": 2107089, "summary_stats": {"h_index": 393}
		//	document.querySelector("#debug").innerText = "Journal: " + data.results[0].display_name + "; Publisher: " + data.results[0].host_organization_name <!-- Get metadata of the selected concept id -->
		//})


		// Create a function to display the json data dynamically on the webpage
		function jsonList(item) {
		  // Create a new div element dynamically
		  //const div = document.createElement("div");
		  // get the required details from the local.json file to the div element using innerHTML
		  //div.innerHTML = `
		   document.querySelector("#debug").innerText = "Journal: " + item.display_name 
		  //`Journal: ${item.display_name}, Publisher: ${item.host_organization_name}, Articles: ${item.works_count}, Citations ${item.cited_by_count},  h-index ${item.summary_stats.h_index},`;
		  // attach the newly created div element to the original div element, in this case to the class '.output'
		  //output.append(div);
		  // Add styling to the displayed content
		  //div.classList.add("active");
		}
	</script>
</body>
</html>
